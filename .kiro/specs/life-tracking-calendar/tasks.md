# 实施计划

## 阶段1：基础项目设置和日历界面

- [x] 1. 项目初始化和依赖配置
  - 清理默认代码，设置项目基础结构
  - 添加必要的依赖包（table_calendar, provider, sqflite等）
  - 配置应用主题和基础样式
  - _需求: 8.1, 8.3, 9.1_

- [x] 2. 创建基础日历界面
  - 实现基础的月视图日历组件
  - 添加日期选择功能
  - 实现简洁的现代化UI设计
  - _需求: 1.1, 8.1, 8.2_

- [x] 3. 实现日历导航功能
  - 添加月份切换功能（前一月/后一月）
  - 实现今天按钮快速回到当前日期
  - 添加流畅的切换动画效果
  - _需求: 8.2, 8.4_

## 阶段2：数据存储和管理基础

- [x] 4. 创建数据模型
  - 定义Tag、TagRecord、DiaryEntry等核心数据模型
  - 实现标签类型枚举（量化、非量化、复杂）
  - 创建基础的数据验证逻辑
  - _需求: 1.2, 2.1, 3.1_

- [x] 5. 实现本地数据存储
  - 设置SQLite数据库结构
  - 实现标签和记录的CRUD操作
  - 创建数据访问层（Repository模式）
  - _需求: 9.4_

## 阶段3：标签系统基础实现

- [x] 6. 实现标签管理界面
  - 创建标签列表显示界面
  - 实现添加新标签功能
  - 支持标签的编辑和删除
  - _需求: 1.2, 2.1, 3.1_

- [x] 7. 实现量化标签功能和折叠式标签管理界面
  - _需求: 1.2, 1.3, 1.6, 1.7, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7_

- [x] 8. 重构日历界面布局
  - 移除日历下方的选中日期信息显示模块
  - 移除"记录"按钮和今天标识
  - 移除当日记录数据显示模块
  - 调整日历界面的整体布局结构
  - _需求: 4.7_

- [x] 9. 创建折叠式标签管理面板组件
  - 创建TagManagementPanel组件，宽度与日历一致
  - 实现折叠/展开动画效果
  - 设计标签展示的网格布局
  - 实现已添加标签和未添加标签的视觉区分（原色 vs 半透明）
  - _需求: 4.1, 4.2, 4.7_

- [x] 10. 实现标签长按交互功能
  - 为已添加标签实现长按弹出修改/删除窗口
  - 为未添加标签实现长按自动添加并弹出修改窗口
  - 创建标签数值修改弹窗组件
  - 实现标签删除确认功能
  - _需求: 4.3, 4.4_

- [x] 11. 实现单标签聚焦模式
  - 实现点击标签时隐藏日历上其他标签数据的功能
  - 保证实现方式能扩展到其他类型的标签上
  - 为量化标签创建热力图显示模式
  - 实现点击空白处恢复所有标签显示
  - 添加聚焦状态的视觉指示器
  - _需求: 4.5, 4.6, 1.6, 1.7_

- [x] 12. 优化日历数据可视化
  - 重构日历单元格的标签数据渲染逻辑
  - 实现量化标签的颜色深浅可视化
  - 实现热力图模式下的数值显示
  - 优化标签数据的加载和缓存机制
  - 实现点击日历模块和标签列表模块之外空白处也能恢复所有标签显示
  - _需求: 1.2, 1.3, 1.4_

## 阶段4：标签类型扩展

- [x] 13. 实现非量化标签功能
  - 创建图标选择器界面
  - 在日历上显示图标标记
  - 为非量化标签创建放大标记显示模式
  - _需求: 2.1, 2.2, 2.3_

- [x] 14. 实现复杂标签功能
  - 在原先折叠式标签管理面板组件下方再创建一个为复杂标签专用的折叠式标签管理面板组件
  - 长按复杂标签，显示复杂标签专用的折叠式标签管理面板组件，并包含该复杂标签所包含的量化和非量化标签，选中与未选中逻辑与原先折叠式标签管理面板一致
  - 实现子标签的动态添加和管理
  - 支持复杂标签的保存和其子标签的聚焦模式显示
  - _需求: 3.1, 3.2, 3.3, 3.4_

## 阶段5：用户测试

- [x] 15. 数据库演示功能扩展
  - 创建一个随机量化标签生成器，随机名字随机数值，随机填充当月（2025年7月，下同）日历
  - 创建一个随机非量化标签生成器，功能同上
  - 创建一个随机复杂标签生成器，其子标签也要生成，规律同上
  - 创建一个生成器，模拟用户使用一年后的日历情况

## 阶段6：标签交互扩展

- [x] 16. 标签交互优化
  - 删掉点击未选中标签添加和长按已选中标签删除的优化逻辑
  - 添加将未选中标签拖动到已选中标签区域使其启用的逻辑，非量化和复杂标签（虽然启用后没有子标签，不知道数据库支不支持这个状态？）直接启用，量化标签在弹出创建窗口，确认后启用
  - 将已启用的标签拖拽到未启用区域后直接删除当日记录
  - 复杂标签的子标签管理面板也实现同样功能，而且要注意其标签与上述主标签管理面板中的标签不允许拖动到不对应的标签管理面板中

- [x] 17. 资源刷新问题
  - 现在拖动标签进行修改后，整个标签管理器都会被重载刷新，会造成闪烁，出现环形加载条，而且管理面板会重新折叠起来，请在保证能够同步数据的前提下，让组件的刷新加载变得无痕，也就是没有过场动画或者组件消失诸如此类。注意，主标签管理器和复杂标签用的子标签管理器要同步修改。
  - 现在拖动标签进行修改后，日历组件没有跟着刷新，日历上的小标记不会变化，除非切换上一月再切换回来，请你保证当标签启用情况发生变化时，日历能够跟着刷新，而且同样保证无痕。

## 阶段7：数据可视化增强

- [ ] 18. 实现条形图功能
  - 创建日历条形图视图。日历自带月视图、周视图和双周视图，而且是通过日历右上角有个小按钮来滚动无缝切换的，我想在这个基础上多加一个可以无缝切换的视图，不是添加一个新弹出的窗口，而是内置进日历组件中
  - 条形图视图只能在量化标签的聚焦模式进入，退出聚焦模式会自动回到月视图
  - 直观显示该标签状态变化趋势
  - 视图的可以使用双指缩放、移动，调整显示范围
  - _需求: 1.5, 1.6_

- [ ] 19. 增强数据可视化
  - 扩展日历上标签小图标的多样性，创建或者使用第三方图标库，每一个标签都可以提供合适的图标代替现在的彩色点（总览下的小图标）或者对勾（非量化标签聚焦模式）
  - _需求: 1.4, 8.3_

## 阶段8：日记界面集成

- [ ] 20. 创建日记输入界面
  - 日记模块是一个没有背景的文本输入区域，在所有模块（日历与标签管理）下方，会在区域末尾保持3行空行（也就是区域会随着输入的内容变多而变大）
  - 实现预设标签行的快速输入界面，集成标签输入和日记内容编辑（拖动标签到日记中，会在当前行创建一个标签颜色背景的标签文字+数值+冒号，比如说"骑车："或者"加班 5小时："或者"睡眠 不良 多梦 8小时："，占据一整行，标签和标签之间不能占据同一行，后面只能接文字，用户可以再冒号后面书写与标签有关的内容。如果是当日没有启用的标签，会先执行启用那些程序，确定后再写进日记里。）
  - 保证标签只能被添加一次，后续的添加无效
  - 标签与标签之间可以没有空行
  - 在标签附属文本区域中按换行键会在日历整体中标签下方创建新行，而不是在标签附属文本区域中换行
  - 在标签附属文本区域中，如果在最开头按删除（退格）键，则会删除这个标签，并保留区域中的剩余文字
  - _需求: 4.1, 4.2, 4.4_

## 阶段9：数据查询和分析

- [ ] 21. 实现数据查询和筛选
  - 实现按标签筛选功能
  - 创建标签数据的统计和趋势分析
  - 支持日期范围查询
  - _需求: 7.1, 7.2, 7.3, 7.4_

## 阶段10：预测功能实现

- [ ] 22. 实现周期设置功能
  - 创建手动周期设置界面
  - 实现周期天数和单位的输入
  - 保存和管理标签的周期配置
  - _需求: 5.1, 5.3_

- [ ] 23. 实现预测算法
  - 开发基于历史数据的周期分析算法
  - 实现自动周期检测功能
  - 生成未来日期的预测标签
  - _需求: 5.2, 5.4, 5.5_

- [ ] 24. 实现预测显示功能
  - 在日历上显示半透明的预测标签
  - 实现预测和实际记录的视觉区分
  - 添加预测依据的详情显示
  - _需求: 6.1, 6.2, 6.3_

## 阶段11：用户体验优化

- [ ] 25. 实现主题适配
  - 支持深色/浅色主题切换
  - 优化不同主题下的颜色方案
  - 实现系统主题自动跟随
  - _需求: 8.5_

- [ ] 26. 实现预测交互功能
  - 添加预测到达时的提醒功能
  - 实现预测标签的确认和更新
  - 支持实际记录替换预测标签
  - _需求: 6.4, 6.5_

- [ ] 27. 实现富文本和多媒体支持
  - 添加图像、音频、视频的录制和选择功能
  - 实现多媒体文件的本地存储
  - 在日记界面中显示多媒体内容
  - 实现富文本编辑功能（粗体、斜体、字体大小、颜色等）
  - _需求: 4.3_

## 阶段12：云同步和跨平台

- [ ] 28. 实现云同步基础架构
  - 集成Firebase或Supabase服务
  - 实现用户认证系统
  - 创建云端数据模型
  - _需求: 9.2_

- [ ] 29. 实现数据同步功能
  - 开发增量同步机制
  - 实现冲突解决策略
  - 添加同步状态指示器
  - _需求: 9.2, 9.4_

- [ ] 30. 实现响应式布局
  - 优化不同屏幕尺寸的界面适配
  - 实现平板和手机的布局差异化
  - 测试iOS和Android平台兼容性
  - _需求: 9.1, 9.3_

## 阶段13：测试和优化

- [ ] 31. 实现单元测试
  - 为核心业务逻辑编写单元测试
  - 测试数据模型和验证逻辑
  - 测试预测算法的准确性
  - _测试策略要求_

- [ ] 32. 实现集成测试
  - 测试完整的用户操作流程
  - 验证数据存储和同步功能
  - 测试错误处理和恢复机制
  - _测试策略要求_

- [ ] 33. 性能优化和最终调试
  - 优化大数据量下的应用性能
  - 修复发现的bug和用户体验问题
  - 进行最终的跨平台测试
  - _测试策略要求_